# Vault 健全性スコア算出式

Vault全体の品質を定量的に評価するスコアリングシステム。

---

## スコア体系概要

**満点**: 100点

**構成**:
- カテゴリ別スコア: 7項目 × 配点
- ペナルティ: リスク度に応じた減算

---

## カテゴリ別スコア

### 1. 命名規則遵守（配点: 20点）

**内訳**:
- デイリージャーナル: 5点
- 読書感想: 2点
- プロジェクトディレクトリ: 2点
- テンプレートファイル: 2点
- 学習記録ファイル: 4点
- 過去問ファイル: 3点
- その他ファイル: 2点

**算出方法**:

```
命名規則スコア = 20 × (違反ファイル数が0の項目数 / 全項目数)
              + 減算（違反数に応じた段階的減算）

詳細:
- 全項目クリア（0違反） → 20点
- 1項目だけ違反（1-3ファイル） → 18点
- 2項目違反（4-6ファイル） → 16点
- 3項目以上違反（7ファイル以上） → 12点以下
```

**例**:
```
デイリージャーナル: 違反なし ✓ (+5点)
読書感想: 違反1件 (-1点)
プロジェクトディレクトリ: 違反なし ✓ (+2点)
...
合計: 20 × (6/7) - 1 = 17.1 → 17点
```

---

### 2. Frontmatter完備（配点: 20点）

**内訳**:
- profile/: 2点
- journal/: 3点
- learning/questions/: 8点
- learning/学習記録/: 3点
- reading/entertainment/: 4点

**算出方法**:

```
frontmatter_score = Σ(各領域のスコア)

各領域の計算:
- 全ファイルfrontmatter完備 → 満点
- 完備率 X% → 満点 × (X/100)
  例: journal/ファイル10個中8個が完備 → 3 × (80/100) = 2.4点

frontmatter_score = 2 + 2.4 + 6.4 + 2.7 + 3.2 = 16.7 → 17点（四捨五入）
```

**完備の定義**:
- 必須フィールドが全て揃っている
- フィールド値が空でない

---

### 3. Wikilink活用（配点: 15点）

**内訳**:
- リンク切れゼロ: 7点
- wikilink活用度: 5点
- セクションリンク整合性: 3点

**算出方法**:

```
wikilink_score = リンク切れ判定(7点) + 活用度判定(5点) + セクション判定(3点)

リンク切れ判定:
- 切れたリンク数: 0 → 7点
- 1-2件 → 5点
- 3-5件 → 3点
- 6件以上 → 1点

活用度判定:
- 期待値の90%以上 → 5点
- 期待値の70-89% → 4点
- 期待値の50-69% → 2点
- 期待値の50%未満 → 0点

セクション判定:
- 整合性100% → 3点
- 95% → 2点
- 80% → 1点
- 80%未満 → 0点
```

**期待値の計算**:
```
profile/ファイル間: 最小3リンク（全4ファイル = 12リンク期待）
CLAUDE.md: 最小15リンク
learning/配下: 最小2-5リンク/ファイル
```

---

### 4. タグ体系統一（配点: 15点）

**内訳**:
- 非標準タグ検出: 8点
- タグ付与率: 5点
- タグ矛盾（同一ファイルの矛盾）: 2点

**算出方法**:

```
tag_score = 非標準タグ判定(8点) + 付与率判定(5点) + 矛盾判定(2点)

非標準タグ判定:
- 非標準タグ 0件 → 8点
- 1-3件 → 6点
- 4-10件 → 4点
- 11-20件 → 2点
- 21件以上 → 0点

付与率判定:
- frontmatterがあるファイルの90%以上に最低1タグ → 5点
- 80-89% → 4点
- 70-79% → 3点
- 60-69% → 2点
- 60%未満 → 0点

矛盾判定:
- 矛盾なし → 2点
- 軽微（1-2件） → 1点
- 複数（3件以上） → 0点

矛盾の例: 「#status/進行中」と「#status/完了」が同時に付与されている
```

---

### 5. リンク切れゼロ（配点: 15点）

**NOTE**: 「3-1. リンク切れ検出」と重複していないか？

実際には **3. Wikilink活用** の「リンク切れゼロ: 7点」と統合。

ここの15点は **より広範な参照整合性** を評価:

- wikilink自体の切れ（ファイルが存在しない）: 7点（3から）
- 参照先ファイルの内容が期待と異なる: 5点
- 後方参照（逆リンク）の整合性: 3点

**算出方法**:

```
link_integrity_score = 7 + content_match(5点) + backlinks(3点)

content_match (5点):
- 参照先ファイルが期待される内容を含む → 5点
- 内容が部分的にズレている（例: 古い情報参照） → 3点
- 内容が完全に異なる → 1点
- 判定不可（バイナリ等） → スキップ

backlinks (3点):
- 逆リンク（AがBを参照、BはAを参照）の整合性が100% → 3点
- 80-99% → 2点
- 60-79% → 1点
- 60%未満 → 0点
```

**逆リンク整合性の例**:
```
profile/基本情報.md が memory_logs.md を参照している
→ memory_logs.md が 基本情報.md を逆参照しているか確認
```

---

### 6. 重複情報ゼロ（配点: 10点）

**算出方法**:

```
duplicate_score = 10 × (1 - 重複度合い)

重複度合い = Σ(各ペアの類似度) / チェック対象ペア数

類似度の計算（TF-IDF）:
- 類似度 0.0-0.2 → 重複なし
- 類似度 0.2-0.3 → 軽微な重複
- 類似度 0.3-0.5 → 中程度の重複
- 類似度 0.5以上 → 深刻な重複

例:
チェック対象ペア5組
- 基本情報 ↔ キャリアロードマップ: 0.35（中程度）
- 基本情報 ↔ 開発活動: 0.15（軽微）
- 学習計画 ↔ memory_logs: 0.22（軽微）
- その他: 0.1以下

重複度合い = (0.35 + 0.15 + 0.22) / 5 = 0.144
duplicate_score = 10 × (1 - 0.144) = 8.56 → 9点
```

---

### 7. テンプレート遵守（配点: 5点）

**算出方法**:

```
template_score = 5 × (テンプレート遵守率)

遵守率 = テンプレート遵守ファイル数 / 遵守対象ファイル総数

対象ファイル:
- journal/YYYY/MM/YYYY-MM-DD.md
- learning/学習記録/YYYY-MM-DD.md
- reading/読書感想_*.md
- (その他テンプレート定義がある領域)

遵守の定義:
- テンプレートのセクション構造を完全に保持
- セクション順序が一致
- セクション名が正確に一致

例:
対象ファイル: 45個
遵守: 40個
違反: 5個
遵守率 = 40/45 = 88.9%
template_score = 5 × 0.889 = 4.45 → 4点
```

---

## ペナルティ計算

### 優先度別ペナルティ

```
総スコア = Σ(カテゴリ別スコア) - ペナルティ

ペナルティの種類:

🔴 Critical Penalty (-5点以上):
  ・編集禁止エリア（.obsidian/, LINE/）の不正修正
  ・学習記録とmemory_logsの役割分担が完全に逆転
  → Vault整合性が根本的に損なわれている

🟠 Major Penalty (-2〜4点):
  ・重複情報の深刻度（類似度0.5以上のペア）
  ・命名規則違反が全体の20%以上
  ・frontmatter不備が全体の30%以上
  ・リンク切れが5件以上

🟡 Minor Penalty (-1点):
  ・非標準タグが11-20件
  ・テンプレート遵守率が70%未満
  ・wikilink活用度が期待値の50%未満
  ・タグ付与率が70%未満

ペナルティの重複適用:
・各ペナルティを独立的に計算
・同じ問題に対して複数ペナルティを適用しない
```

---

## スコアランク

```
S: 90-100点 → 最高の状態。Vaultはほぼ完璧
A: 80-89点  → 良好な状態。定期的なメンテナンスで十分
B: 70-79点  → まあまあ。軽微な改善が必要
C: 60-69点  → 警告。重要な改善が必要
D: 50-59点  → 要注意。構造的な問題あり
E: 0-49点   → 緊急。Vaultの再編成が必要
```

---

## 具体的な計算例

### ケース1: 良好な状態

```
命名規則: 20点（全項目クリア）
frontmatter: 18点（journal/にX件不備）
wikilink: 13点（リンク切れ1件、活用度OK）
タグ体系: 14点（非標準タグ2件）
リンク整合性: 14点（backlinks整合性90%）
重複情報: 9点（軽微な重複あり）
テンプレート: 5点（遵守率100%）

小計: 93点

ペナルティ: -1点（非標準タグ Minor）

総合スコア: 92点 → Sランク
```

### ケース2: 要改善の状態

```
命名規則: 14点（複数項目違反）
frontmatter: 12点（learning/questionsで多数不備）
wikilink: 8点（リンク切れ6件）
タグ体系: 8点（非標準タグ多数、付与率低）
リンク整合性: 10点（content_match低）
重複情報: 5点（中程度の重複複数）
テンプレート: 2点（遵守率60%未満）

小計: 59点

ペナルティ: -3点（Major: frontmatter不備30%超、リンク切れ5件超）

総合スコア: 56点 → Dランク

推奨: 緊急改善（frontmatter自動追加、リンク修正、重複統合）
```

---

## スコア推移の追跡

毎回のチェック実行時に前回スコアと比較。

**記録形式**:
```
📊 スコア推移:
  2025-12-01: 72点（Bランク）
  2025-12-15: 78点（Bランク） ↑ +6点
  2026-01-01: 85点（Aランク） ↑ +7点
  2026-02-01: 92点（Sランク） ↑ +7点

分野別の改善トレンド:
  ・frontmatter: 12点 → 18点 ↑ +6点（自動追加効果）
  ・タグ体系: 6点 → 14点 ↑ +8点（正規化効果）
  ・リンク整合性: 9点 → 14点 ↑ +5点（重複統合効果）
```

---

## 計算の自動化

スコア算出は以下のステップで実装:

1. **データ収集フェーズ**: check-rules.mdのすべての項目をスキャン
2. **スコア算出フェーズ**: 各カテゴリの点数を独立的に計算
3. **ペナルティ計算フェーズ**: ペナルティテーブルを参照して減算
4. **ランク判定フェーズ**: 総スコアからランクを決定
5. **記録フェーズ**: memory_logs.md に記録

---

## ベンチマーク値

初期状態（新規Vault）の想定スコア:

```
新規Vault: 45-55点（Eランク）
  → 理由: frontmatter, wikilink, タグがほぼ0

3ヶ月後（安定期）: 70-80点（Bランク）
  → 理由: 基本構造は確立、細部の改善が必要

6ヶ月後（成熟期）: 85-95点（Aランク以上）
  → 理由: 定期的なメンテナンス効果
```

---

*最終更新: 2026-02-01*
