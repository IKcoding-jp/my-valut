---
name: maintain
description: >-
  Vault全体の競合性・統一性・一貫性・保守性を自動チェックし、問題を検出・修正する最強メンテナンススキル。
  「Vault整理」「メンテナンス」「整合性チェック」「/maintain」で起動。
  週次レトロスペクティブ時に定期実行を推奨。
---

# Vault メンテナンススキル（maintain）

「記録する」だけでなく「記録を整える」フィードバックループを実現するスキル。
Vault全体の品質を定量的に評価し、段階的に改善する。

---

## 実行フロー（6ステップ）

### Step 1: データ収集（Vault全体スキャン）

**実行内容**:
1. Vault全体のファイル構造をスキャン
2. メタデータ抽出：
   - frontmatterの有無と内容
   - wikilink（[[...]]), tags, タイムスタンプ
   - ファイル名と実ディレクトリ階層の比較
3. 参照情報の収集：
   - CLAUDE.md に記載されているファイル一覧
   - 各ファイルの更新日時（last_modified）

**出力**: 
- スキャン統計（総ファイル数、領域別ファイル数）
- frontmatter完備率（領域別）
- wikilink密度（領域別）

**チェックルール参照**: `[[.claude/skills/maintain/references/check-rules]]` の全10項目

---

### Step 2: 定量分析（健全性スコア算出）

**実行内容**:

Step 1で収集したデータをもとに、下記カテゴリ別にスコアを算出：

1. **命名規則遵守** (20点)
   - 7パターンの命名規則チェック
   - 違反ファイル数に応じた段階的減点

2. **Frontmatter完備** (20点)
   - 領域別の完備率を集計
   - 必須フィールド充足度を評価

3. **Wikilink活用** (15点)
   - リンク切れ検出（7点）
   - 活用度分析（5点）
   - セクションリンク整合性（3点）

4. **タグ体系統一** (15点)
   - 非標準タグ検出とマッピング
   - タグ付与率の分析
   - 矛盾検出（同一ファイル内の矛盾）

5. **リンク整合性** (15点)
   - wikilink+参照先の内容整合性
   - 逆リンク（backlinks）の整合性

6. **重複情報ゼロ** (10点)
   - TF-IDFスコアで類似度を計算
   - profile/, learning/ 内の重複を検出

7. **テンプレート遵守** (5点)
   - デイリージャーナル、学習記録等
   - セクション構造・順序の完全性

**ペナルティ計算**:
- 🔴 Critical (-5点以上): 編集禁止エリアの不正修正等
- 🟠 Major (-2~4点): 命名規則違反20%超、frontmatter不備30%超等
- 🟡 Minor (-1点): 非標準タグ多数等

**スコアランク**:
```
S: 90-100   A: 80-89   B: 70-79   C: 60-69   D: 50-59   E: 0-49
```

**チェックルール参照**: `[[.claude/skills/maintain/references/scoring]]`

---

### Step 3: 定性分析（問題パターン特定）

**実行内容**:

定量スコアを補完する定性分析：

1. **問題分類**
   - 🔴 緊急問題（スコア5点以下の項目）
     - リンク切れが5件以上
     - frontmatter不備が全体30%超
     - 編集禁止エリアの不正修正
   
   - 🟡 推奨改善（スコア6-10点の項目）
     - 非標準タグが複数
     - 重複情報が中程度存在
     - テンプレート遵守率70%未満
   
   - 🟢 良好な点
     - クリアした項目（満点またはほぼ満点）

2. **根本原因の推測**
   - なぜこの問題が発生しているのか
   - 例: 「frontmatter不備 = 過去問ファイルを自動取得スクリプトで作成したが、frontmatter挿入ロジックが未実装」

3. **優先度付け**
   - データ品質への影響度
   - 修正の難度（自動化可能か）
   - 実施スケジュール

---

### Step 4: レポート生成（優先度別）

**実行内容**:

以下形式でレポートを生成し、ユーザーに表示：

```markdown
📊 Vault健全性チェック（YYYY-MM-DD）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🏆 健全性スコア: XX / 100点 → [S/A/B/C/D/E] ランク

📈 カテゴリ別スコア:
  ・命名規則遵守: XX / 20点
  ・frontmatter完備: XX / 20点
  ・wikilink活用: XX / 15点
  ・タグ体系統一: XX / 15点
  ・リンク整合性: XX / 15点
  ・重複情報ゼロ: XX / 10点
  ・テンプレート遵守: XX / 5点

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔴 緊急問題（X件）:
  1. [問題種別] [ファイルパス]
     詳細: [具体的な問題内容]
     修正案: [自動修正可能 / 手動確認必要]
     影響度: [高/中/低]

🟡 推奨改善（X件）:
  1. [問題種別] [ファイルパス]
     詳細: [具体的な問題内容]
     修正案: [具体的な提案]

🟢 良好な点:
  ・[良好な項目を列挙]
  ・[改善された項目]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⏰ スコア推移:
  前回: YY点（YYYY-MM-DD実施）
  今回: XX点
  変化: ±ZZ点（向上 / 悪化 / 不変）
```

---

### Step 5: 修正実行の確認

**実行内容**:

レポート表示後、ユーザーに修正内容を提示し、実行許可を取得：

1. **修正提案の整理**
   ```
   ✅ 自動修正可能（低リスク）:
     1. [frontmatter追加] learning/questions/...
     2. [タグ正規化] #learning/FE → #learning/基本情報
     3. [命名規則修正] journal/ 配下のファイル移動

   ⚠️ 手動確認が必要（中~高リスク）:
     1. [重複情報統合] profile/基本情報.md ↔ キャリアロードマップ.md
     2. [ファイル削除提案] ideas/古いアイデア.md

   ❌ スキップ推奨:
     1. [編集禁止エリア] .obsidian/ の不正修正 (手動で git reset)
   ```

2. **ユーザー確認**
   ```
   質問: 「以下の修正を実行してよろしいですか？」
   - [x] 自動修正をすべて実行
   - [ ] 一部のみ実行（カスタマイズ）
   - [ ] スキップして分析結果のみ見る
   - [ ] Vault修正を取りやめ、詳細分析のみ出力
   ```

3. **Git安全性確認**
   ```
   実行前チェック:
   - [ ] 現在ブランチ: main
   - [ ] 未コミット変更: なし
   - [ ] バックアップcommit作成: git commit -m "chore: Vault健全性チェック前バックアップ"
   ```

---

### Step 6: 記録と保存

**実行内容**:

修正実行完了後、結果を記録：

1. **memory_logs.md へ追記**
   ```markdown
   - **YYYY-MM-DD（Vault健全性チェック）**:
     - スコア: XX/100点（前回比 ±XX点）
     - 実施内容: [frontmatter自動追加XX件、タグ正規化XX箇所、...]
     - 主要改善: [最も効果があった修正TOP 3]
     - 残課題: [今後対応が必要な項目]
   ```

2. **vault-health-reports/ へレポート保存**
   ```
   D:\My vault\vault-health-reports\YYYY-MM-DD.md
   
   形式: frontmatter + markdown
   frontmatter:
     ---
     date: YYYY-MM-DD
     score: XX
     rank: [S/A/B/C/D/E]
     previous_score: YY
     changes: ±ZZ
     tags: ["#maintain", "#status/完了"]
     ---
   ```

3. **Git commit 作成**
   ```
   git add -A
   git commit -m "chore: Vault健全性チェック実施 (スコア XX/100, 自動修正 XX件適用)"
   git status で変更を確認
   ```

---

## リファレンスガイド

本スキルは3つのreferenceドキュメントに基づいて動作：

| ファイル | 役割 | 参照タイミング |
|---------|------|----------------|
| `[[.claude/skills/maintain/references/check-rules]]` | 10項目のチェックルール完全定義 | Step 1-2（データ収集・定量分析） |
| `[[.claude/skills/maintain/references/scoring]]` | スコア算出式・ペナルティ計算 | Step 2（定量分析） |
| `[[.claude/skills/maintain/references/auto-fix]]` | 自動修正可能な6項目の実装ロジック | Step 5-6（修正実行） |

---

## 他スキルとの連携

| スキル | 連携内容 |
|--------|---------|
| **retrospective** | 週次レトロ終了後に「Vault整理しますか？」と提案 |
| **recommendation** | 前回チェックから30日以上経過時に maintain スキル推奨 |
| **morning** | journal/ 未運用を検出時に「デイリージャーナルを始めますか？」 |
| **study** | learning/questions/ の frontmatter不備を検出時に修正提案 |
| **fetch-questions** | 過去問取得後に frontmatter自動挿入 |
| **daily-report** | 学習記録作成時に frontmatter テンプレート適用 |

---

## 実行頻度の目安

| フェーズ | 推奨頻度 | 理由 |
|---------|--------|------|
| **学習集中期**（試験前1ヶ月） | 週1回 | 過去問ファイル急増に対応 |
| **通常期** | 2週間に1回 | 習慣的な品質維持 |
| **試験直前**（残り7日） | 実施しない | 学習に集中 |
| **スコアが著しく低下** | 即実施 | 緊急対応 |

---

## 注意事項

### Git安全性

- **修正前**: `git commit -m "chore: Vault健全性チェック実行前のバックアップ"` で保存
- **修正後**: `git status`, `git log` で変更を確認
- **ロールバック**: 失敗時は `git revert` で前のcommitに戻す

### エンコーディング統一

- Markdownファイル: **UTF-8**（デフォルト）
- 過去問道場CSV: **cp932** (auto-fix.md 参照)

### パフォーマンス最適化

- 100KB超のファイル：重複検出スキップ
- learning/questions/ の2,065ファイル：差分スキャンで高速化
- 前回スキャン結果をキャッシュ：変更ファイルのみ再スキャン

### 編集禁止エリア

- `.obsidian/` 配下：**絶対に編集しない**（Obsidian設定）
- `LINE/` 配下：**自動同期フォルダ**、直接編集しない

---

## FAQ

**Q: 修正後にスコアが下がることはあるか？**

A: ほぼありません。ただし「隠れていた問題を検出した」ケースでは、初回実行時にスコア低下することがあります。これは良い兆候（潜在問題の可視化）です。

**Q: 自動修正を一部だけ実行できるか？**

A: はい。Step 5で「カスタマイズ」を選択し、実行する修正を指定できます。

**Q: スコアはどのくらい上昇するか？**

A: 環境に大きく依存します。frontmatter追加を自動実行すれば10-20点上昇する可能性があります。

**Q: 修正内容に不同意の場合は？**

A: 「スキップして分析結果のみ」を選択し、提案を参考に手動で修正してください。

---

## 期待される成果

✅ Vault全体の健全性を自動的に監視・維持  
✅ 命名規則、frontmatter, wikilink, タグの統一性が保たれる  
✅ 情報の重複が検出・解消される  
✅ 定期実行により、Vaultの品質が継続的に向上  
✅ 健全性スコアで Vault の状態が可視化される

---

*最終更新: 2026-02-01*
