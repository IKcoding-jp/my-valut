---
name: kaizen
description: >-
  コード実装・リファクタリング、アーキテクチャ設計、プロセス改善、エラーハンドリングに使用。
  過剰設計を避け、反復的な改善を適用する技法を提供する。
  「改善して」「リファクタリング」「設計見直し」「スクリプト修正」「仕組みを良くしたい」等で起動。
---

# Kaizen: 継続的改善

小さな改善を積み重ねる。設計段階でエラーを防ぐ。うまくいくパターンに従う。必要なものだけ作る。

---

## 対象スコープ

このスキルは **FE学習ナレッジベースの改善** に適用する:

| 対象 | 具体例 |
|------|--------|
| **スクリプト** | `scripts/fetch_question.py` の改修・新スクリプト作成 |
| **スキル定義** | `.claude/skills/*/SKILL.md` の改善・新規作成 |
| **Markdownファイル構造** | frontmatter仕様、テンプレート、フォルダ構成 |
| **ワークフロー** | セッション手順、データ取り込みフロー、CSV連携 |
| **CLAUDE.md** | ルール追加・更新・整合性チェック |

---

## 4つの柱

### 1. 継続的改善（カイゼン）

小さく頻繁な改善が、大きな成果に複利で効く。

**原則:**
- **革新より漸進**: 品質を上げる最小の変更を1つずつ行う
- **通りがかり改善**: 作業中に見つけた小さな問題はその場で直す（スコープ内で）
- **反復的洗練**: まず動かす → 読みやすくする → 堅牢にする。3つを同時にやらない

**実践例:**

```
# ❌ 一気にやろうとする
「frontmatterの仕様変更 + テンプレート更新 + 全既存ファイル移行 + ダッシュボード計算ロジック変更」
→ 変更が多すぎて、どこで壊れたか分からない

# ✅ 1つずつ進める
Step 1: frontmatter仕様を決めてテンプレートを更新
Step 2: 既存ファイルを新仕様に移行（動作確認）
Step 3: ダッシュボード計算を新仕様に対応させる
→ 各ステップで検証可能
```

**適用タイミング:**
- スクリプトの機能追加 → 最小の変更を加えてテスト → 次の変更
- スキル定義の改善 → 1セクションずつ見直す
- CLAUDE.mdの更新 → セクション10の波及チェックリストに従い段階的に

### 2. ポカヨケ（エラー防止）

そもそもエラーが起きない仕組みを設計する。

**原則:**
- **エラーを不可能にする**: 型・バリデーション・制約で間違いを防ぐ
- **早く失敗する**: 問題は実行開始時に検出し、途中で壊れないようにする
- **正しい道を簡単に**: 正しい使い方がデフォルトになる設計

**実践例:**

```python
# ❌ エラーが起きやすい設計
def process_csv(path):
    with open(path) as f:  # エンコーディング未指定 → 文字化け
        data = csv.reader(f)
        for row in data:
            # カラム名でなくインデックスでアクセス → ずれたら壊れる
            result = row[1]

# ✅ ポカヨケ設計
def process_csv(path: str, encoding: str = 'cp932'):
    """過去問道場CSVを読み込む。cp932がデフォルト（Windows環境）。"""
    if not Path(path).exists():
        raise FileNotFoundError(f"CSVが見つかりません: {path}")

    with open(path, encoding=encoding) as f:
        reader = csv.DictReader(f)  # カラム名でアクセス → ずれない
        for row in reader:
            result = row['正誤']  # 明示的で安全
```

```yaml
# ❌ frontmatterのバリデーションなし
status: がくしゅうちゅう  # タイポに気づけない

# ✅ 許容値を明記し、スクリプトでバリデーション
# status: 未学習 | 学習中 | 習得済み（3値のみ）
status: 学習中
```

**適用タイミング:**
- スクリプト作成時 → 入力バリデーション・エンコーディング明示・パス存在チェック
- frontmatter仕様変更時 → 許容値の明示・既存ファイルの整合性チェック
- ワークフロー設計時 → 手順の順序ミスを防ぐチェックポイント設置

### 3. 標準化（パターンに従う）

既存のパターンに従う。うまくいく方法を記録する。良い慣行を簡単に守れるようにする。

**原則:**
- **一貫性 > 独自性**: 既存のコードベースパターンに合わせる
- **ドキュメントはコードと共に**: CLAUDE.mdにルールを集約し、スキル間で矛盾させない
- **テンプレートで標準化**: 新規ファイル作成時はテンプレートから始める

**このプロジェクトの標準パターン:**

| 要素 | 標準パターン |
|------|-------------|
| 問題ファイル | YAML frontmatter + Markdown本文（`questions/`の既存形式に従う） |
| 学習記録 | `学習記録/_テンプレート.md` をベースに作成 |
| スキル定義 | `name` + `description` のfrontmatter → 日本語の本文 |
| コミット | セッション終了時にまとめて。日本語メッセージ |
| CSV読み込み | `encoding='cp932'` を必ず指定 |
| パス操作 | 日本語パスはクォーティングに注意（Windows環境） |

**適用タイミング:**
- 新しいスクリプト → 既存の`fetch_question.py`のスタイルに合わせる
- 新しいスキル → 他スキルのSKILL.md構造に合わせる
- 方針変更時 → CLAUDE.mdセクション10の波及チェックリストを必ず実行

### 4. ジャスト・イン・タイム（必要なものだけ）

今必要なものだけを作る。「いつか使うかも」は作らない。

**原則:**
- **YAGNI**: 現在の要件だけを実装する。「念のため」のコードは書かない
- **最もシンプルな解法**: まず単純な方法で解決し、複雑さは必要になってから足す
- **計測してから最適化**: 遅いと「感じる」だけでは最適化しない

**実践例:**

```python
# ❌ 過剰設計: 今は1種類のCSVしかないのに汎用フレームワークを作る
class GenericCSVImporter:
    def __init__(self, schema, validators, transformers, plugins):
        ...
class CSVValidationPipeline:
    ...
class CSVTransformEngine:
    ...

# ✅ 今の要件を満たすシンプルな関数
def import_gomadou_csv(path: str) -> list[dict]:
    """過去問道場CSVを読み込み、辞書リストで返す。"""
    with open(path, encoding='cp932') as f:
        return list(csv.DictReader(f))
```

```markdown
<!-- ❌ まだ使わない機能をスキルに入れる -->
## 将来の拡張予定
- AI自動採点機能
- 他の資格試験対応
- マルチユーザー対応

<!-- ✅ 今必要な機能だけ記述する -->
## 機能
- 過去問道場CSV取り込み
- 分野別正答率集計
```

**適用タイミング:**
- 新機能の提案時 → 「今すぐ必要か？」を問う
- スクリプトの拡張時 → 汎用化は3つ以上の類似ケースが出てから
- ファイル構造の変更時 → 現在の問題を解決する最小の変更にとどめる

---

## 改善ワークフロー

作業中に改善の機会を見つけたときの手順:

```
1. 課題を特定する
   └─ 何が問題で、どんな影響があるか？

2. スコープを確認する
   └─ 今のタスクの範囲内か？ 範囲外なら記録だけして後回し

3. 最小の変更を決める
   └─ この問題を解決する最もシンプルな方法は？

4. 波及を確認する（CLAUDE.md セクション10）
   └─ この変更で他のファイルに影響はないか？

5. 実行 → 検証
   └─ 変更を加えて、壊れていないことを確認

6. 記録する
   └─ 変更理由を docs/memory_logs.md やコミットメッセージに残す
```

---

## 危険信号（レッドフラッグ）

以下のパターンが出たら立ち止まる:

| パターン | 問題 | 対処 |
|---------|------|------|
| 「あとでリファクタリングする」 | 大抵やらない | 今やるか、明示的にTODOを残す |
| 一度に5ファイル以上を変更 | 波及範囲が広すぎ | 段階的に分割する |
| 「念のため」のコード | 過剰設計 | 今の要件だけに集中 |
| 既存パターンと違う書き方 | 一貫性の欠如 | 既存パターンを確認してから |
| バリデーションなしの入力処理 | エラーの温床 | 入口でチェックする |

---

## 他スキルとの連携

| スキル | 連携内容 |
|--------|---------|
| **study** | セッション中に発見した改善点を記録 |
| **daily-report** | 改善内容を日次記録に含める |
| **retrospective** | 週次で改善の効果を振り返る |
| **fetch-questions** | スクリプト改修時にkaizen原則を適用 |

---

*最終更新: 2026-02-01（FE学習ナレッジベース向けに全面改訂・日本語化）*
