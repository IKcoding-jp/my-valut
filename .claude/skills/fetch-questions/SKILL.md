---
name: fetch-questions
description: >-
  過去問の一括取得。「過去問取得」「問題を追加」「R06の問題を取って」等で起動。
  自然言語を scripts/fetch_question.py のコマンドに変換して実行する軽量スキル。
---

# 過去問取得（fetch-questions）

過去問道場から問題を取得するための軽量ラッパー。
学習セッションのコンテキストを読み込まず、素早く問題を取得する。

---

## トリガー

以下のような発言で起動する:
- 「過去問取得 R06 問1-20」
- 「R05の科目A全部取って」
- 「令和6年の問題を追加して」
- 「問題を増やしたい」

---

## コマンド変換ルール

ユーザーの自然言語入力を `scripts/fetch_question.py` のコマンドに変換する。

### 入力パターン → 実行コマンド

| ユーザー入力の例 | 実行コマンド |
|---|---|
| `過去問取得 R05 問15` | `python scripts/fetch_question.py R05 15` |
| `R05の問15を取って` | `python scripts/fetch_question.py R05 15` |
| `過去問取得 R05 問1-20` | `python scripts/fetch_question.py R05 1-20` |
| `R06の最初の20問` | `python scripts/fetch_question.py R06 1-20` |
| `過去問取得 R05 科目A` | `python scripts/fetch_question.py R05 all` |
| `R06の科目A全部` | `python scripts/fetch_question.py R06 all` |
| `令和5年の全問題` | `python scripts/fetch_question.py R05 all` |

### 年度の変換ルール

| ユーザー表現 | 変換後 |
|---|---|
| 令和7年 / R7 / R07 | R07 |
| 令和6年 / R6 / R06 | R06 |
| 令和5年 / R5 / R05 | R05 |
| 令和4年 / R4 / R04 | R04 |
| 令和3年 / R3 / R03 | R03 |
| 令和2年 / R2 / R02 | R02 |
| 令和元年秋 / R1秋 | R01秋 |
| 平成30年秋 / H30秋 | H30秋 |
| 平成30年春 / H30春 | H30春 |

### 対応年度

- 新制度 CBT: R07, R06, R05
- 旧制度 免除: R04, R03, R02
- 旧制度 春秋: R01秋 〜 H21春

---

## 実行フロー

### Step 1: 入力の解析

ユーザーの発言から以下を抽出:
- **年度**: R05, R06 等
- **範囲**: 単一問題番号 / 範囲（1-20） / all

### Step 2: バリデーション

- 年度が対応範囲内か確認
- 範囲指定の場合、最大80問の制限を確認
- 不明な場合はユーザーに確認:

```
どの年度の問題を取得しますか？
対応年度: R07, R06, R05, R04, R03, R02, R01秋〜H21春
```

### Step 3: コマンド実行

```bash
python scripts/fetch_question.py [年度] [問題番号/範囲/all]
```

- 作業ディレクトリは `D:\FEvault`（リポジトリルート）
- Windows環境では `python`（`python3` ではなく）を使用

### Step 4: 結果の報告

```
✅ 問題を取得しました！

📥 取得結果:
  ・新規取得: XX問
  ・スキップ（既存）: XX問
  ・保存先: questions/kamoku_a/[分野]/

💡 取得した問題で学習を始めるには「学習開始」と入力してください。
```

### Step 5: エラー処理

- ネットワークエラー → 「インターネット接続を確認してください」
- 年度が見つからない → 「この年度の問題は対応していません。対応年度: ...」
- スクリプトエラー → エラーメッセージを表示し、手動実行コマンドを案内

---

## 制約

- 1回のコマンドで最大80問まで（範囲指定時）
- `all` 指定時は年度により60問（R02以降）または80問（R01以前）を一括取得
- 既に存在する問題はスキップされる（重複防止）
- このスキルは問題の取得のみ。学習セッションの開始は行わない

---

## 注意事項

- セッション開始手順（memory_logs.md読み込み等）は不要
- learning_progress.md の更新は行わない（問題取得のみ）
- 取得後にダッシュボードの「総問題」数が変わるが、更新は次回セッション終了時に行われる
- **画像URL**: fetch_question.py がページURLのディレクトリ部分（base_url）を使って相対パスの画像を絶対URLに自動変換する。手動での修正は不要
- **R07（令和7年度）**: 2026年1月時点で未公開のため、取得を試みると404エラーになる。公開され次第対応可能
