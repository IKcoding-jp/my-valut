---
name: recommendation
description: >-
  学習推奨ナビ。「今日何やる？」「次何する？」等で起動。
  データ分析→根拠付きTOP3提案→即学習開始を一気通貫で実行。
---

# 学習推奨ナビ（recommendation）

「今日何やる？」「次何する？」「おすすめは？」といった自然な質問を自動的に捕捉し、
データ分析に基づいた根拠付きのTOP3タスク提案を行い、
そのままセッション開始につなげるスキル。

---

## トリガー（自動認識）

以下の質問のいずれかで自動的に起動:

- 「今日は何やる？」「今日何やる？」
- 「今日のおすすめ」「おすすめは？」
- 「次何やる？」「次何する？」
- 「何から始めればいい？」「何をやるべき？」
- 「カウントダウン」「残り日数は？」
- 「今日の方針」「学習計画は？」
- study セッション開始時の「おまかせ」選択

---

## ステップ1: データ読み込み

以下の4ファイルを読み込み、分析用の情報を抽出する:

### 1. `learning_progress.md`（ダッシュボード）

読み込み対象:
- `days_remaining`: 試験までの残り日数
- `overall_accuracy`: 全体正答率
- 科目A・B の分野別正答率
- 危険問題リスト（自信高×不正解）
- セッション履歴

### 2. `学習計画表.md`（学習計画）

読み込み対象:
- `days_remaining`: 試験までの日数（再計算確認）
- 現在のフェーズ（Phase 1/2/3）
- 週別スケジュール（今週の予定内容）
- 時間帯別の役割（朝=科目B、昼=科目A、夜=科目A）

### 3. `docs/memory_logs.md`（長期記憶）

読み込み対象:
- 直近の「重要な文脈・マイルストーン」セクション（最新2-3エントリ）
- 心理状態の兆候（「モチベーション低下」「つらい」等）
- 学習者の強み・弱み

### 4. `学習記録/` の最新3日分

読み込み対象:
- 直近3日の学習内容・正答率
- 空白期間の検知（3日以上学習していない場合はフラグ）
- 最近のつまずきポイント

---

## ステップ2: 推奨タスク選定ロジック

### 危険問題チェック（最優先）

`learning_progress.md` の「危険問題リスト」を確認:

- **危険問題が3件以上**: TOP 1に「危険問題の復習」を自動挿入
  - 理由: 「自信があったのに間違えた問題＝本番で失点する確率が高い。ここの定着が最優先です」
  
- **危険問題が1-2件**: TOP 3内に「危険問題の復習」を含める

### 適応的優先度スコア計算

`study/references/dashboard.md` に記載の基本計算式をベースに、以下の**適応的要素**を加味:

```
適応的優先度スコア = 基本スコア × トレンド係数 × 忘却係数 × 残日数調整

基本スコア = (100 - 分野理解度) × 出題頻度係数 × 弱点係数
弱点係数: 危険問題がある分野は ×1.5
```

#### トレンド係数（改善トレンドを反映）

直近3回のセッション正答率の傾きから算出:
- **下降トレンド**（-5%以上悪化）: ×1.3（停滞・後退は最優先で対処）
- **横ばい**（±5%以内）: ×1.1（伸びが止まっている＝アプローチ変更の余地）
- **上昇トレンド**（+5%以上改善）: ×0.9（効果が出ている＝他の分野に注力）

#### 忘却係数（最終学習日からの経過日数）

分野内の問題ファイルの `last_attempt` から最終学習日を特定:
- **7日以上未学習**: ×1.4（忘却が進行、復習が急務）
- **4〜6日未学習**: ×1.2（そろそろ復習が必要）
- **2〜3日未学習**: ×1.0（通常）
- **昨日〜今日学習済み**: ×0.8（直近に触れた＝他を優先）

#### 残日数調整（試験が近づくほど戦略が変わる）

- **残り14日以上**: 調整なし（均等に伸ばす）
- **残り7〜13日**: 正答率40%未満の分野に ×1.3（底上げ優先）
- **残り3〜6日**: 正答率50%以上の分野に ×1.2（確実な得点源を固める）
- **残り1〜2日**: 最も正答率が高い分野のみ ×1.5（自信の補強）

**出題頻度係数（科目A）**:
- セキュリティ: 1.5（最重要）
- ネットワーク: 1.3
- データベース: 1.2
- コンピュータシステム: 1.1
- 基礎理論: 1.0
- その他（マネジメント、ストラテジ等）: 0.8

### 🔁 忘却曲線トラッカー（復習推奨リスト）

習得済み問題が「忘れかけている頃」を自動検知し、復習を推奨する。

#### 判定ロジック

`questions/` 内の `status: 習得済` の問題に対して:

| confidence_history 最新値 | 復習推奨タイミング | 緊急度 |
|---------------------------|-------------------|--------|
| 4-5（高い自信） | last_attempt から 7日後 | 低 |
| 3（普通の自信） | last_attempt から 3日後 | 中 |
| 1-2（低い自信） | last_attempt から 翌日 | 高 |

#### 表示方法

推奨TOP3出力の**前に**、復習推奨がある場合のみ表示:

```
🔁 忘却防止リマインダー（復習推奨 X件）:
  ・[問題ID] [分野] — 最終学習: X日前（自信度: X）
  ・[問題ID] [分野] — 最終学習: X日前（自信度: X）
  → 「復習する」で上記問題から出題 / スキップしてTOP3へ進む
```

#### 制約

- 表示は最大5件まで（多すぎると圧倒される）
- 直前期（残り3日以下）では復習推奨を非表示にする（新しい不安を増やさない）
- 習得済み問題がない場合はこのセクション自体を非表示

### 週次レトロスペクティブ連携

ステップ1（データ読み込み）時に以下を追加チェック:

- `docs/memory_logs.md` の最新エントリに「週次レトロスペクティブ」が **7日以上前** or **未実施**
  → 推奨TOP3の前に「💡 週次振り返りがまだです。先に `/retrospective` を実行しますか？」と提案

### タスク選定の優先順位

| 優先順 | 条件 | 推奨タスク | 根拠テンプレート |
|--------|------|-----------|-----------------|
| 0 | 危険問題が1件以上 | 「危険問題の復習」 | 「自信があったのに間違えた問題＝本番で失点する確率が高い」 |
| 1 | 前回から3日以上空白 | 「軽いウォームアップ」 | 「XX日ぶりなので、まず感覚を取り戻しましょう」 |
| 2 | 正答率40%未満かつ出題頻度1.0以上の分野 | 「○○分野の重点学習」 | 「出題頻度が高い＋正答率が低い＝最も得点アップの効率が良い」 |
| 3 | 正答率40%未満かつ暗記系 | 「○○の暗記強化」 | 「暗記だけで+XX%伸ばせる。計算不要で最も効率的」 |
| 4 | 理解度0%の新規分野 | 「新規分野の初習」 | 「まだ触れていない分野。0→40%は最も伸びやすい段階」 |
| 5 | 合格ライン（55%）に近い分野 | 「○○をあと一押し」 | 「あと XX%で安定ライン到達。少しの演習で合格ラインに乗る」 |
| 6 | 上記すべて非該当 | 「統合模試の実施」 | 「弱点がなくなりつつある。本番形式で仕上げましょう」 |

---

## ステップ3: 出力フォーマット

### 通常期（残り8日以上）

```
🎯 試験まであと XX 日！
━━━━━━━━━━━━━━━━━━━━━━━━
📊 あなたの現在地:
  全体正答率: XX%（目標60%まで -XX%）
  最も伸びしろが大きい分野: [分野名]（正答率XX%）

📋 今やるべきこと TOP 3:

1️⃣ [タスク名]
   → [具体的なアクション]
   📈 根拠: [なぜこれが最も得点アップにつながるか]
   ⏱️ 所要時間: 約XX分

2️⃣ [タスク名]
   → [具体的なアクション]
   📈 根拠: [理由]
   ⏱️ 所要時間: 約XX分

3️⃣ [タスク名]
   → [具体的なアクション]
   📈 根拠: [理由]
   ⏱️ 所要時間: 約XX分

💡 今の時間帯のおすすめ:
  [朝/昼/夜に応じたコメント]

🧠 メンタルチェック:
  [学習状況に応じた声掛け]
━━━━━━━━━━━━━━━━━━━━━━━━

👉 どうしますか？
  「1」「2」「3」で番号を選択 / 「始める」で1番から即スタート / 「今日はいい」で終了
```

### 直前期（残り7〜2日）

```
⚡ 試験まであと XX 日！ラストスパント！
━━━━━━━━━━━━━━━━━━━━━━━━
📊 現在の状態（残り7日で対策必須）:
  🔴 要対策: [分野名]（正答率XX%）
  🟡 もう少し: [分野名]（正答率XX%）
  ✅ 安定: [分野名]（正答率XX%）

📋 今日の集中ポイント:

1️⃣ [最優先タスク]
   📈 残り7日で +XX% 伸ばせば、目標到達！
   ⏱️ 所要時間: XX分

2️⃣ [2番目のタスク]
   📈 [根拠]

3️⃣ [3番目のタスク]
   📈 [根拠]

⚠️ 新しい分野には手を出さない！復習に集中！

🫁 メンタルケア（直前期スペシャル）:
  [残り日数に応じたメンタルサポート + 呼吸法案内]
  例: 「スクエア呼吸法を実践しましょう。4秒吸う→4秒止める→4秒吐く→4秒止める」
━━━━━━━━━━━━━━━━━━━━━━━━

👉 1番から始めますか？
```

### 前日（残り1日）

```
🌟 明日は本番です！🌟
━━━━━━━━━━━━━━━━━━━━━━━━

📋 今日やること:
1️⃣ 弱点問題を5問だけ軽く復習
2️⃣ 持ち物チェック（受験票・本人確認書類・筆記用具）
3️⃣ 早めに休む（23時までに就寝）

🚫 やらないこと:
  ✗ 新しい問題を解く
  ✗ 苦手分野を深追いする
  ✗ 夜更かしして詰め込む
  ✗ 不安を感じても復習に走る

💪 ここまで頑張ったあなたへ:
  「もう十分やりました。あとは体調を整えるだけ。
   試験当日は、栢木先生の5つのポイントを思い出してください：
   ✅ 完璧を目指さない
   ✅ 分からなければ喜ぶ
   ✅ 時間は作るもの
   ✅ 80%で十分
   ✅ できなかった問題は『伸びしろ』」

🎯 自分を信じて。頑張ってください！
━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## ステップ4: study スキルへの遷移

ユーザーの応答に応じて自動的に study スキルに遷移:

| ユーザーの応答 | 動作 |
|---------------|------|
| 「始める」「やる」「OK」 | TOP 1のタスクで study スキル開始 |
| 「1」「2」「3」（番号） | 指定タスクで study スキル開始 |
| 「科目A」「科目B」等 | 指定科目で study スキル開始 |
| 「今日はいい」「休む」 | 「お疲れさまです。また明日！」で終了 |
| 「詳しく知りたい」「なぜ？」 | 推奨根拠をさらに詳しく説明 |

### 遷移時のルール

**重要**: study が改めてデータを読み込むため、データの二重読み込みが発生します。
これはスキル間でメモリが共有されていないため避けられません（許容するトレードオフ）。

遷移後、study は:
- 推奨ナビのステップ1（ファイル読み込み）を **改めて実行**
- セッション開始手順をステップ3（目標確認）から開始（ステップ1-2はスキップ）
- 直接コアワークフロー（問題選択→出題）に入る

---

## 曜日・時間帯に応じた調整

推奨タスク選定後、提案内容を時間帯に応じて調整:

| 時間帯 | 朝（4-9時） | 昼（11-13時） | 夜（18-23時） | 休日（終日） |
|--------|------------|------------|------------|-----------|
| 推奨科目 | **科目B** | **科目A** | **科目A** | **科目B** |
| 推奨スタイル | 質重視 | 回転数重視 | 回転数重視 | じっくり |
| 推奨分野 | トレース練習 | 過去問回転・基礎理論 | 基礎理論＋暗記系 | 『出るとこだけ』・IPA |

提案は「朝のあなたの場合は、科目Bから始めるのがおすすめです」のように時間帯を考慮した内容に。

---

## メタ認知・学習状態の検知

おすすめナビ出力時に、以下の指標で学習者の心理状態を検知:

| 検知シグナル | 対応 |
|------------|------|
| 3日以上空白 | 「久しぶりですね！無理せず軽めから始めましょう」 |
| 連日学習中（7日以上） | 「XX日連続学習中！ナイスペース 💪」 |
| memory_logs.md に「つらい」「くじけそう」等 | mental-coach スキルとの連携を提案 |
| 危険問題が増加傾向 | 「復習のテンポが落ちている可能性。軽い復習から始めましょう」 |

---

## 注意事項

### リードオンリーモード

- `learning_progress.md`、`学習計画表.md`、`docs/memory_logs.md` は **読み取り専用**
- 推奨ナビ自身は**これらのファイルを更新しない**
- ダッシュボード更新は study スキルが行う（セッション終了時）

### データ分析の一貫性

- 優先度スコア計算は `study/references/dashboard.md` の「優先度スコア計算」セクションを厳密に実装
- 出題頻度係数テーブルもそのまま使用
- 変更がある場合は dashboard.md に反映されるため、定期的に確認

### 推奨の根拠の正確性

- 根拠テンプレートは単なるテンプレートではなく、**実際のデータに基づいた具体的な数字を含める**
- 「XX%伸ばせる」という表現は、現在の正答率と目標正答率の差分から計算
- 「あとXX日」という表現は days_remaining から計算

---

## 実装上の留意点

1. **優先度計算の最適化**: 複数分野の優先度スコアを並べ替え、TOP 3 を抽出
2. **危険問題の優先化**: スコア計算の前に、危険問題があればそれを TOP に挿入
3. **時間帯の自動判定**: システムの現在時刻から時間帯を判定し、提案内容を最適化
4. **エッジケース対応**:
   - 学習初日（学習記録なし）→ Phase 1 のスケジュール推奨
   - 直前期自動検知 → days_remaining が 7以下なら直前期フォーマットに切替
   - 全分野で正答率80%以上 → 「十分な準備ができています。模試で最終確認」

---

## 参考資料

- `study/references/dashboard.md`: 優先度スコア計算・出題頻度係数テーブル
- `study/SKILL.md`: 学習セッションの全体フロー・コアワークフロー
- `CLAUDE.md` セクション4: メンタルコーチング原則（CARE原則）
- `docs/memory_logs.md`: 学習者の心理状態・マイルストーン

---

*最終更新: 2026-01-31（適応的優先度エンジン・忘却曲線トラッカー・レトロスペクティブ連携を追加）*
