# 適応的優先度エンジン 詳細仕様

## 適応的優先度スコア計算

`study/references/dashboard.md` の基本計算式をベースに、以下の適応的要素を加味する。

```
適応的優先度スコア = 基本スコア × トレンド係数 × 忘却係数 × 残日数調整

基本スコア = (100 - 分野理解度) × 出題頻度係数 × 弱点係数
弱点係数: 危険問題がある分野は ×1.5
```

### トレンド係数（改善トレンドを反映）

直近3回のセッション正答率の傾きから算出:
- **下降トレンド**（-5%以上悪化）: ×1.3（停滞・後退は最優先で対処）
- **横ばい**（±5%以内）: ×1.1（伸びが止まっている＝アプローチ変更の余地）
- **上昇トレンド**（+5%以上改善）: ×0.9（効果が出ている＝他の分野に注力）

### 忘却係数（最終学習日からの経過日数）

分野内の問題ファイルの `last_attempt` から最終学習日を特定:
- **7日以上未学習**: ×1.4（忘却が進行、復習が急務）
- **4〜6日未学習**: ×1.2（そろそろ復習が必要）
- **2〜3日未学習**: ×1.0（通常）
- **昨日〜今日学習済み**: ×0.8（直近に触れた＝他を優先）

### 残日数調整（試験が近づくほど戦略が変わる）

- **残り14日以上**: 調整なし（均等に伸ばす）
- **残り7〜13日**: 正答率40%未満の分野に ×1.3（底上げ優先）
- **残り3〜6日**: 正答率50%以上の分野に ×1.2（確実な得点源を固める）
- **残り1〜2日**: 最も正答率が高い分野のみ ×1.5（自信の補強）

### 出題頻度係数（科目A）

| 分野 | 係数 |
|------|------|
| セキュリティ | 1.5（最重要） |
| ネットワーク | 1.3 |
| データベース | 1.2 |
| コンピュータシステム | 1.1 |
| 基礎理論 | 1.0 |
| その他（マネジメント、ストラテジ等） | 0.8 |

---

## 忘却曲線トラッカー（復習推奨リスト）

習得済み問題が「忘れかけている頃」を自動検知し、復習を推奨する。

### 判定ロジック

`learning/questions/` 内の `status: 習得済` の問題に対して:

| confidence_history 最新値 | 復習推奨タイミング | 緊急度 |
|---------------------------|-------------------|--------|
| 4-5（高い自信） | last_attempt から 7日後 | 低 |
| 3（普通の自信） | last_attempt から 3日後 | 中 |
| 1-2（低い自信） | last_attempt から 翌日 | 高 |

### 表示方法

推奨TOP3出力の**前に**、復習推奨がある場合のみ表示:

```
🔁 忘却防止リマインダー（復習推奨 X件）:
  ・[問題ID] [分野] — 最終学習: X日前（自信度: X）
  → 「復習する」で上記問題から出題 / スキップしてTOP3へ進む
```

### 制約

- 表示は最大5件まで（多すぎると圧倒される）
- 直前期（残り3日以下）では復習推奨を非表示にする（新しい不安を増やさない）
- 習得済み問題がない場合はこのセクション自体を非表示

---

## タスク選定の優先順位

| 優先順 | 条件 | 推奨タスク | 根拠テンプレート |
|--------|------|-----------|-----------------|
| 0 | 危険問題が1件以上 | 「危険問題の復習」 | 「自信があったのに間違えた問題＝本番で失点する確率が高い」 |
| 1 | 前回から3日以上空白 | 「軽いウォームアップ」 | 「XX日ぶりなので、まず感覚を取り戻しましょう」 |
| 2 | 正答率40%未満かつ出題頻度1.0以上 | 「○○分野の重点学習」 | 「出題頻度が高い＋正答率が低い＝最も得点アップの効率が良い」 |
| 3 | 正答率40%未満かつ暗記系 | 「○○の暗記強化」 | 「暗記だけで+XX%伸ばせる。計算不要で最も効率的」 |
| 4 | 理解度0%の新規分野 | 「新規分野の初習」 | 「まだ触れていない分野。0→40%は最も伸びやすい段階」 |
| 5 | 合格ライン（55%）に近い分野 | 「○○をあと一押し」 | 「あと XX%で安定ライン到達」 |
| 6 | 上記すべて非該当 | 「統合模試の実施」 | 「弱点がなくなりつつある。本番形式で仕上げましょう」 |
