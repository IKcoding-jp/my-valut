---
id: R05_KB_Q05
year: R05
kamoku: B
number: 5
type: セキュリティ
subtopic: SQLインジェクション対策
difficulty: 2
status: 未学習
last_attempt: null
confidence_history: []
result_history: []
time_spent_seconds: []
---

## 問題

あるWebアプリケーションでは、利用者が入力した会員番号をもとに、次のSQL文を組み立てて会員情報を検索している。

```sql
SELECT * FROM 会員 WHERE 会員番号 = '入力値'
```

このWebアプリケーションに対して、悪意のある利用者が会員番号の入力欄に次の文字列を入力した。

```
' OR '1' = '1
```

この攻撃に関する記述のうち、最も適切なものはどれか。

## 選択肢
- ア: この攻撃はクロスサイトスクリプティング（XSS）と呼ばれ、対策としてはHTMLの特殊文字をエスケープすることが有効である
- イ: この攻撃はSQLインジェクションと呼ばれ、対策としてはプレースホルダ（バインド変数）を用いてSQL文を組み立てることが有効である
- ウ: この攻撃はSQLインジェクションと呼ばれ、対策としては入力値の文字数を制限することだけで十分である
- エ: この攻撃はディレクトリトラバーサルと呼ばれ、対策としてはファイルパスの正規化が有効である

## 正解
イ

## 解説

### 攻撃の仕組み

悪意のある入力値 `' OR '1' = '1` がSQL文に埋め込まれると、次のようなSQL文が実行される:

```sql
SELECT * FROM 会員 WHERE 会員番号 = '' OR '1' = '1'
```

**何が起きるか、順を追って見てみよう:**

1. `会員番号 = ''` → 会員番号が空文字のレコードを探す（普通は該当なし）
2. `OR` → 「または」の意味。左か右のどちらかが成り立てばOK
3. `'1' = '1'` → 「1は1と等しい」→ **常に成り立つ（真）**

結果: `WHERE` 条件が常に真になるため、**会員テーブルの全レコードが返される**。本来見えてはいけない他人の会員情報がすべて表示されてしまう。

### 正解の理由

この攻撃は **SQLインジェクション** である。利用者の入力値がSQL文の一部として直接組み込まれることで、攻撃者が意図したSQL文が実行されてしまう。

最も有効な対策は **プレースホルダ（バインド変数）** を使うことである:

```sql
SELECT * FROM 会員 WHERE 会員番号 = ?
```

プレースホルダ `?` を使うと、入力値は「SQL文の命令」ではなく「ただのデータ」として扱われる。つまり `' OR '1' = '1` という文字列がそのまま会員番号として検索され、SQL文の構造を変えることができなくなる。

**各選択肢の検討:**

- **ア（誤り）**: クロスサイトスクリプティングはWebページにスクリプトを埋め込む攻撃であり、SQL文への攻撃ではない
- **イ（正解）**: SQLインジェクションの説明と対策が正しい
- **ウ（誤り）**: SQLインジェクションという名称は正しいが、文字数制限だけでは対策として不十分。短い文字列でも攻撃は可能
- **エ（誤り）**: ディレクトリトラバーサルはファイルパスを操作する攻撃であり、SQL文への攻撃ではない

### セキュリティのポイント
- SQLインジェクションは「入力値がSQL文の構造を変えてしまう」攻撃
- 最も有効な対策はプレースホルダ（バインド変数）を使うこと
- 入力値のバリデーション（検証）やエスケープ処理も補助的な対策になるが、プレースホルダが第一選択
- Webアプリケーションの代表的な脆弱性として、試験でも頻出

### 類似パターン
- [[クロスサイトスクリプティング（XSS）]]（HTML/JavaScriptへの攻撃）
- [[ディレクトリトラバーサル]]（ファイルパスへの攻撃）
- [[OSコマンドインジェクション]]（OS コマンドへの攻撃）
