---
id: R01A_KA_Q29
year: R01秋
kamoku: A
number: 29
type: 暗記
field: テクノロジ系 » データベース »トランザクション処理
difficulty: 3
status: 未学習
source: "出典：令和元年秋期 基本情報技術者試験 科目A 問29"
source_url: "https://www.fe-siken.com/kakomon/01_aki/q29.html"
last_attempt: null
confidence_history: []
result_history: []
time_spent_seconds: []
---

## 問題
2相ロッキングプロトコルに従ってロックを獲得するトランザクションA，Bを図のように同時実行した場合に，デッドロックが発生しないデータ処理順序はどれか。ここで，read と update の位置は，アプリケーションプログラムでの命令発行時点を表す。また，データWへの read は共有ロックを要求し，データX，Y，Zへの update は各データへの専有ロックを要求する。![29.png/image-size:207×238](https://www.fe-siken.com/kakomon/01_aki/img/29.png)

## 選択肢


## 正解
ウ

## 解説
デッドロック
とは、共有資源を使用する2つ以上のトランザクションが、互いに相手トランザクションが必要とする資源を排他的に使用していて、互いのトランザクションが相手が使用している資源の解放を待っている状態です。デッドロックが発生するとトランザクションは永遠に待ち状態になってしまうため、処理の続行ができなくなってしまいます。
この問題では、2つのトランザクションのロック要求を追跡することでデッドロックが発生するか否かを判断しますが、その前提として共有ロック・専有ロック及び2相ロッキングプロトコルについて確認しておきましょう。
共有ロックデータを読込むときに使うロックで、この状態の場合は他のトランザクションによる更新処理ができなくなる(読込みは可能)。専有ロックデータを更新するときに使うロックで、この状態の場合は他のトランザクションによる読込みや更新ができなくなる。
上記の性質から、ある資源に共有または専有ロックが掛けられているときの新たなロックの可否は次の表のようになります。
つまり、資源にかけられているロックが"共有"である場合にのみ、別のトランザクションが新たに"共有ロック"をかけることが可能です。
そして、
2相ロッキングプロトコル
は、トランザクションで読書きが必要となるたびに都度ロックをかけていき、
全てのロックを取得し終えてからまとめて解除する
ロック方式です。つまり、ロックの解除が行われるのはトランザクションの終了時になります。各処理が終わる度に当該ロックを解除するわけではないので注意しましょう。
これを踏まえて、トランザクションA(以下、T
A
)とトランザクションB(以下、T
B
)の処理を選択肢ごとに見ていきます。

### 各選択肢の解説
- ア: TAが W を共有ロックする。TBが W を共有ロックする。TAが X を専有ロックする。TBが Y を専有ロックする。TAが Y の専有ロックを要求するが、TBが専有ロック中なので待ち状態となる。TBが X の専有ロックを要求するが、TAが専有ロック中なので待ち状態となる。TAが Y の解放を、TBが X の解放を互いに待っているのでデッドロックとなる。
TAが W を共有ロックする。
TBが W を共有ロックする。
TAが X を専有ロックする。
TBが Y を専有ロックする。
TAが Y の専有ロックを要求するが、TBが専有ロック中なので待ち状態となる。
TBが X の専有ロックを要求するが、TAが専有ロック中なので待ち状態となる。
TAが Y の解放を、TBが X の解放を互いに待っているのでデッドロックとなる。
- イ: TAが W を共有ロックする。TBが W を共有ロックする。TAが X を専有ロックする。TBが Y を専有ロックする。TAが Y の専有ロックを要求するが、TBが専有ロック中なので待ち状態となる。TBが Z を専有ロックする。TBが X の専有ロックを要求するが、TAが専有ロック中なので待ち状態となる。TAが Y の解放を、TBが X の解放を互いに待っているのでデッドロックとなる。
TAが W を共有ロックする。
TBが W を共有ロックする。
TAが X を専有ロックする。
TBが Y を専有ロックする。
TAが Y の専有ロックを要求するが、TBが専有ロック中なので待ち状態となる。
TBが Z を専有ロックする。
TBが X の専有ロックを要求するが、TAが専有ロック中なので待ち状態となる。
TAが Y の解放を、TBが X の解放を互いに待っているのでデッドロックとなる。
- ウ: TAが W を共有ロックする。TBが X を専有ロックする。TAが X の専有ロックを要求するが、TBが専有ロック中なので待ち状態となる。TBが W を共有ロックする。TBが Y を専有ロックする。TBが Z を専有ロックする。TBの終了によりロックが解除される。TAが X を専有ロックする。TAが Y を専有ロックする。TAが Z を専有ロックする。TAの終了によりロックが解除される。この順序だとデッドロックが発生しません。一般的に双方のトランザクションで資源の専有順序が同じ場合にはデッドロックが発生しないことが知られています。本問でも、TA・TBともに X→Y→Z の順になっています。
TAが W を共有ロックする。
TBが X を専有ロックする。
TAが X の専有ロックを要求するが、TBが専有ロック中なので待ち状態となる。
TBが W を共有ロックする。
TBが Y を専有ロックする。
TBが Z を専有ロックする。
TBの終了によりロックが解除される。
TAが X を専有ロックする。
TAが Y を専有ロックする。
TAが Z を専有ロックする。
TAの終了によりロックが解除される。
- エ: TAが W を共有ロックする。TBが Y を専有ロックする。TAが X を専有ロックする。TBが Z を専有ロックする。TAが Y の専有ロックを要求するが、TBが専有ロック中なので待ち状態となる。TBが X の専有ロックを要求するが、TAが専有ロック中なので待ち状態となる。TAが Y の解放を、TBが X の解放を互いに待っているのでデッドロックとなる。
TAが W を共有ロックする。
TBが Y を専有ロックする。
TAが X を専有ロックする。
TBが Z を専有ロックする。
TAが Y の専有ロックを要求するが、TBが専有ロック中なので待ち状態となる。
TBが X の専有ロックを要求するが、TAが専有ロック中なので待ち状態となる。
TAが Y の解放を、TBが X の解放を互いに待っているのでデッドロックとなる。

### 関連概念
- [[TA・TB]]
- [[トランザクション]]
- [[プロトコル]]
